#!/bin/bash

# RAG CLI wrapper script
# –£–ø—Ä–æ—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAG —Å–∏—Å—Ç–µ–º—ã

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CLI_SCRIPT="$SCRIPT_DIR/cli.py"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.7+"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ CLI —Å–∫—Ä–∏–ø—Ç–∞
if [[ ! -f "$CLI_SCRIPT" ]]; then
    echo "‚ùå CLI —Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: $CLI_SCRIPT"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–∫—É –µ—Å–ª–∏ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
if [[ $# -eq 0 ]]; then
    echo "ü§ñ RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Python –∫–æ–¥–∞"
    echo ""
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
    echo "  rag \"–≤–æ–ø—Ä–æ—Å\" [–æ–ø—Ü–∏–∏]"
    echo ""
    echo "–ü—Ä–∏–º–µ—Ä—ã:"
    echo "  rag \"–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å PrefixedDBModel?\""
    echo "  rag \"–ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç –º–µ—Ç–æ–¥ render?\" --tool=tool_bge_code"
    echo "  rag \"–ü–æ–∫–∞–∂–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞\" --verbose"
    echo ""
    echo "–û–ø—Ü–∏–∏:"
    echo "  --tool=TOOL          –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (tool_llm_encoder, tool_bge_code, auto)"
    echo "  --verbose, -v        –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥"
    echo "  --help, -h           –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
    echo ""
    exit 0
fi

# –ü–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ Python —Å–∫—Ä–∏–ø—Ç
exec python3 "$CLI_SCRIPT" "$@"
